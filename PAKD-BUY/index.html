<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAKD BUY 3.1 â€“ SKU Aluminum Strategy</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700;800&family=Inter:wght@400;500;600;700;800;900&display=swap');

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PAKD BUY 3.1 â€” Laptop 13/14" readability revision
   Thay Ä‘á»•i chÃ­nh:
   â€¢ Ná»n: #05080f â†’ #0e1520  (sÃ¡ng hÆ¡n, bá»›t Ä‘en tuyá»‡t Ä‘á»‘i)
   â€¢ Chá»¯ chÃ­nh: #c4cfde â†’ #dce6f4  (tÆ°Æ¡ng pháº£n cao hÆ¡n)
   â€¢ NhÃ£n/label: #3a5060 â†’ #7ba3be  (sÃ¡ng gáº¥p Ä‘Ã´i, dá»… Ä‘á»c)
   â€¢ Font size tÄƒng toÃ n bá»™ ~1â€“2 cáº¥p
   â€¢ Tags, th, kpi-l, kpi-s, lbl: táº¥t cáº£ tÄƒng size
   â€¢ Viá»n: tá»« #111e2d â†’ #1e3347 (sÃ¡ng hÆ¡n, rÃµ hÆ¡n trÃªn mÃ n nhá»)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

*{box-sizing:border-box;margin:0;padding:0;}

body{
  font-family:'Inter',sans-serif;
  background:#0e1520;          /* sÃ¡ng hÆ¡n #05080f */
  color:#dce6f4;               /* sÃ¡ng hÆ¡n #c4cfde */
  height:100vh;
  overflow:hidden;
  font-size:14px;              /* base rÃµ rÃ ng */
}

.mono{font-family:'JetBrains Mono',monospace;}

::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:#0e1520;}
::-webkit-scrollbar-thumb{background:#2a3f58;border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:#3a5570;}

/* â”€â”€ Inputs â”€â”€ font tÄƒng .72â†’.82, ná»n sÃ¡ng hÆ¡n, viá»n rÃµ hÆ¡n */
.inp{
  width:100%;
  background:#141f30;
  border:1px solid #2a3f58;   /* sÃ¡ng hÆ¡n #162030 */
  color:#dce6f4;
  border-radius:4px;
  padding:5px 8px;
  font-size:.82rem;            /* tÄƒng tá»« .8rem */
  transition:border-color .15s;
}
.inp:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.15);}
.inp-xs{padding:4px 6px;font-size:.78rem;}   /* tÄƒng tá»« .72 */
.inp-sm{padding:5px 7px;font-size:.80rem;}   /* tÄƒng tá»« .76 */
select.inp option{background:#141f30;}
.inp[readonly]{background:#0c1420;color:#4d6a82;cursor:not-allowed;}

/* â”€â”€ Labels â”€â”€ tÄƒng .57â†’.68rem, mÃ u #3a5060â†’#7ba3be */
.lbl{
  display:block;
  font-size:.68rem;            /* tÄƒng tá»« .57rem */
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.07em;
  color:#7ba3be;               /* sÃ¡ng tá»« #3a5060 */
  margin-bottom:3px;
}

/* â”€â”€ Cards â”€â”€ ná»n sÃ¡ng hÆ¡n, viá»n rÃµ hÆ¡n */
.card{background:#131e2e;border:1px solid #1e3347;border-radius:8px;padding:13px;}
.card-inset{background:#0f1928;border:1px solid #1a2e42;border-radius:6px;padding:10px;}

/* â”€â”€ Section headers â”€â”€ tÄƒng .58â†’.71rem, mÃ u #2a4055â†’#6b9ab8 */
.sh{
  font-size:.71rem;            /* tÄƒng tá»« .58rem */
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.09em;
  color:#6b9ab8;               /* sÃ¡ng tá»« #2a4055 */
  border-bottom:1px solid #1e3347;
  padding-bottom:7px;
  margin-bottom:11px;
  display:flex;align-items:center;gap:6px;
}

/* â”€â”€ Tags/Badges â”€â”€ tÄƒng .6â†’.73rem, padding tÄƒng, mÃ u sÃ¡ng hÆ¡n */
.tag{
  display:inline-flex;align-items:center;
  padding:2px 8px;             /* tÄƒng tá»« 1px 7px */
  border-radius:4px;
  font-size:.73rem;            /* tÄƒng tá»« .6rem */
  font-weight:800;
  font-family:'JetBrains Mono',monospace;
  white-space:nowrap;
}
/* MÃ u tag sÃ¡ng hÆ¡n â€” dá»… Ä‘á»c trÃªn mÃ n nhá» */
.tg{background:#041f0d;color:#4ade80;border:1px solid #166534;}
.ty{background:#1c1500;color:#fcd34d;border:1px solid #854d0e;}
.tr{background:#1c0505;color:#fc8181;border:1px solid #991b1b;}
.tb{background:#04102e;color:#93c5fd;border:1px solid #1d4ed8;}
.tp{background:#0f0528;color:#d8b4fe;border:1px solid #6d28d9;}
.ts{background:#131e2e;color:#94a3b8;border:1px solid #2a3f58;}

/* â”€â”€ Buttons â”€â”€ font tÄƒng .73â†’.78rem */
.btn{
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 12px;
  border-radius:5px;
  font-size:.78rem;            /* tÄƒng tá»« .73rem */
  font-weight:700;
  cursor:pointer;border:none;transition:all .15s;
  font-family:'Inter',sans-serif;
}
.btn-ghost{background:transparent;border:1px dashed #2a3f58;color:#60a5fa;}
.btn-ghost:hover{background:#071830;border-color:#3b82f6;}
.btn-solid{background:#0f2040;color:#93c5fd;border:1px solid #1e3a5f;}
.btn-solid:hover{background:#1e3a5f;color:#fff;}
.btn-sm{padding:4px 9px;font-size:.73rem;}
.btn-xs{padding:3px 7px;font-size:.67rem;}

/* btn-danger: sÃ¡ng tá»« #2a3d50 â†’ #4a7090 */
.btn-danger{
  background:transparent;border:none;
  color:#4a7090;               /* sÃ¡ng hÆ¡n nhiá»u */
  padding:2px 5px;cursor:pointer;border-radius:3px;font-size:.82rem;
}
.btn-danger:hover{color:#fc8181;background:#3b0a0a30;}
.btn-success{background:#041f0d;border:1px solid #166534;color:#4ade80;}
.btn-success:hover{background:#166534;color:#fff;}

/* â”€â”€ Table â”€â”€ font .77â†’.82rem, th .57â†’.68rem, mÃ u th #2a4055â†’#7ba3be */
.tbl{width:100%;border-collapse:collapse;font-size:.82rem;}
.tbl th{
  background:#0c1726;
  color:#7ba3be;               /* sÃ¡ng tá»« #2a4055 â€” Ráº¤T QUAN TRá»ŒNG */
  font-size:.68rem;            /* tÄƒng tá»« .57rem */
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.06em;
  padding:7px 8px;             /* tÄƒng tá»« 6px 7px */
  text-align:center;
  border-bottom:1px solid #1e3347;
  white-space:nowrap;
}
.tbl td{
  padding:4px 5px;             /* tÄƒng tá»« 3px 4px */
  border-bottom:1px solid #111d2c;
  vertical-align:middle;
}
.tbl tbody tr:hover td{background:#0d1a28;}
.tbl tfoot td{border-top:1px solid #1d4ed8;padding:7px 9px;font-weight:700;}
.tbl .inp{background:#0c1726;border-color:#1e3347;}
.tbl .inp:focus{background:#0e1e32;border-color:#3b82f6;}

/* â”€â”€ KPI â”€â”€ label .54â†’.66rem, sub .6â†’.7rem, mÃ u #2a4055â†’#6b9ab8 */
.kpi{padding:11px 13px;background:#0c1726;border:1px solid #1e3347;border-radius:7px;}
.kpi-l{
  font-size:.66rem;            /* tÄƒng tá»« .54rem */
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.07em;
  color:#6b9ab8;               /* sÃ¡ng tá»« #2a4055 */
  margin-bottom:4px;
}
.kpi-v{font-family:'JetBrains Mono',monospace;font-size:1.25rem;font-weight:800;line-height:1.15;}
.kpi-s{
  font-size:.7rem;             /* tÄƒng tá»« .6rem */
  color:#5a7a92;               /* sÃ¡ng tá»« #2a4055 */
  margin-top:3px;
}

/* â”€â”€ Nav tabs â”€â”€ font .7â†’.77rem, mÃ u inactive #2a4055â†’#5a7a92 */
.nav-tab{
  padding:6px 13px;
  font-size:.77rem;            /* tÄƒng tá»« .7rem */
  font-weight:700;
  cursor:pointer;border-radius:5px;
  border:1px solid transparent;
  color:#5a7a92;               /* sÃ¡ng tá»« #2a4055 */
  transition:all .15s;background:transparent;
}
.nav-tab.on{background:#131e2e;border-color:#1e3347;color:#93c5fd;}
.nav-tab:not(.on):hover{color:#93c5fd;}

/* â”€â”€ Status buttons â”€â”€ font .65â†’.72rem */
.status-btn{
  flex:1;padding:4px 8px;
  font-size:.72rem;            /* tÄƒng tá»« .65rem */
  font-weight:700;border-radius:4px;cursor:pointer;
  transition:all .15s;border:1px solid transparent;
  font-family:'Inter',sans-serif;
}
.status-btn.s-stock{background:#041f0d;border-color:#166534;color:#4ade80;}
.status-btn.s-transit{background:#1c1500;border-color:#854d0e;color:#fcd34d;}
.status-btn.off{background:transparent;border-color:#1e3347;color:#4a7090;}

/* â”€â”€ SKU cards â”€â”€ */
.sku-card{background:#0c1726;border:1px solid #1e3347;border-radius:7px;padding:11px 13px;transition:border-color .15s;}
.sku-card:hover{border-color:#2a4a68;}
.sku-card.warn{border-color:#991b1b;background:#0e0808;}
.sku-card.ok{border-color:#166534;}

/* â”€â”€ Chart/misc â”€â”€ */
.chart-box{background:#0c1726;border:1px solid #1e3347;border-radius:7px;padding:11px;}
.div-line{border-top:1px solid #1e3347;margin:8px 0;}

@media print{
  .no-print{display:none!important;}
  body{background:#fff;color:#000;height:auto;overflow:auto;}
  .card,.kpi,.sku-card{background:#fff;border:1px solid #ccc;}
  .tbl th{background:#f3f4f6;color:#374151;}
}
</style>
</head>
<body>
<div id="root" style="height:100vh;display:flex;flex-direction:column;overflow:hidden;"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useMemo,useCallback} = React;

const ALLOYS  = ["A1050","A1060","A3003","A3003 CT","A3105","A5052","A5083","A6061","A6063"];
const TEMPERS = ["H14","H16","H18","H24","H32","H34","H111","O","T5","T6"];
const THICKS  = ["0.4","0.5","0.6","0.7","0.8","0.9","1.0","1.2","1.5","2.0","2.5","3.0","4.0","5.0","6.0"];
const WIDTHS  = ["600","800","1000","1200","1220","1250","1500","1524","2000"];
const LENGTHS = ["Coil","1000","1200","2000","2400","2500","3000","4000","6000","Custom"];

const skuKey   = r => `${r.alloy}|${r.temper}|${r.thickness}|${r.width}|${r.length}`;
const skuLabel = r => `${r.alloy} ${r.temper}  ${r.thickness}Ã—${r.width}Ã—${r.length}`;

const uid = () => Date.now() + Math.random();
const fv  = v => (isNaN(v)||!isFinite(v)) ? '0' : new Intl.NumberFormat('vi-VN').format(Math.round(v));
const fu  = v => new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:1}).format(v||0);
const pn  = s => parseFloat(String(s).replace(/\./g,'').replace(/,/g,''))||0;

// â”€â”€ PURE ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const weightedAvg = rows => {
  const qty = rows.reduce((s,r)=>s+(r.qtyKg||r.qty||0), 0);
  const val = rows.reduce((s,r)=>s+(r.qtyKg||r.qty||0)*r.avgCost, 0);
  return qty > 0 ? val/qty : 0;
};

const groupBySku = rows => {
  const map = {};
  rows.forEach(r => {
    const k = skuKey(r);
    if (!map[k]) map[k] = {
      key:k, label:skuLabel(r),
      alloy:r.alloy, temper:r.temper, thickness:r.thickness, width:r.width, length:r.length,
      inStock:[], inTransit:[]
    };
    if (r.status==='IN_STOCK') map[k].inStock.push(r);
    else map[k].inTransit.push(r);
  });
  return Object.values(map);
};

const calcInvoice = (products, exRate) => {
  const usd = products.reduce((s,p)=>s+(p.qtyKg/1000)*p.priceFC, 0);
  return {invoiceUSD:usd, invoiceVND:usd*exRate};
};

const calcLanded = (invoiceVND, totalKg, inp) => {
  const mgmt    = invoiceVND*(inp.managementFee/100);
  const tax     = invoiceVND*(inp.importTax/100);
  const freight = Math.max(0, inp.freightTotal);
  const proc    = inp.processingCost*totalKg;
  const total   = invoiceVND+mgmt+tax+freight+proc;
  return {mgmt, tax, freight, proc, landedVND:total, landedPerKg:totalKg>0?total/totalKg:0};
};

const calcFinance = (invoiceVND, land, totalKg, inp) => {
  const days = inp.leadTime + inp.holdingTime;
  let fin = 0;
  if (inp.paymentMethod==='TT') {
    fin = (invoiceVND+land.tax+land.freight)*(inp.capitalCostPercent/100)*(days/365);
  } else {
    fin = invoiceVND*(inp.lcOpenFee/100)
        + invoiceVND*(inp.lcInterest/100)*(inp.lcDays/365)
        + (invoiceVND*inp.lcMargin/100+land.tax+land.freight)*(inp.capitalCostPercent/100)*(days/365);
  }
  return {finVND:fin, finPerKg:totalKg>0?fin/totalKg:0};
};

const calcProductBreakdown = (products, land, fin, totalKg, inp) => {
  return products.map(p => {
    const ratio  = totalKg>0 ? p.qtyKg/totalKg : 0;
    const invVND = (p.qtyKg/1000)*p.priceFC*inp.exchangeRate;
    const mgmt   = invVND*(inp.managementFee/100);
    const tax    = invVND*(inp.importTax/100);
    const freight= land.freight*ratio;
    const proc   = inp.processingCost*p.qtyKg;
    const finRow = fin.finVND*ratio;
    const landedRow = invVND+mgmt+tax+freight+proc;
    const physPerKg = p.qtyKg>0 ? landedRow/p.qtyKg : 0;
    const econPerKg = physPerKg + (p.qtyKg>0 ? finRow/p.qtyKg : 0);
    return {...p, invVND, landedRow, finRow, physPerKg, econPerKg};
  });
};

const calcSkuBlend = (inventory, purchaseRows, sellingPrices, globalContractPrice, inputs) => {
  const skuGroups = groupBySku(inventory);
  return purchaseRows.map(p => {
    const k   = skuKey(p);
    const grp = skuGroups.find(g=>g.key===k);
    const stockRows   = grp ? grp.inStock   : [];
    const transitRows = grp ? grp.inTransit : [];
    const allExisting = [...stockRows, ...transitRows];
    const avgCurrent  = weightedAvg(allExisting);
    const avgStock    = weightedAvg(stockRows);
    const avgTransit  = weightedAvg(transitRows);
    const qtyStock    = stockRows.reduce((s,r)=>s+r.qtyKg,0);
    const qtyTransit  = transitRows.reduce((s,r)=>s+r.qtyKg,0);
    const qtyExisting = qtyStock + qtyTransit;
    const newRow   = {qtyKg:p.qtyKg, avgCost:p.physPerKg||0};
    const avgAfter = weightedAvg([...allExisting, newRow]);
    const qtyAfter = qtyExisting + p.qtyKg;
    const finPerKg = p.qtyKg>0 ? p.finRow/p.qtyKg : 0;
    const custFin  = avgAfter*(inputs.lendingRate/100)*(inputs.customerCreditDays/365);
    const breakEven = avgAfter + finPerKg + custFin;
    const spKey1 = p.alloy+' '+p.temper;
    const spKey2 = p.alloy;
    const sp = sellingPrices.find(s=>s.alloy===spKey1) || sellingPrices.find(s=>s.alloy===spKey2);
    const sellPrice = sp ? sp.price : globalContractPrice;
    const realProfit = sellPrice*(1-inputs.businessRiskPercent/100) - breakEven;
    const isRisk     = breakEven > sellPrice;
    return {
      ...p, skuKey:k, skuLbl:skuLabel(p),
      avgCurrent, avgStock, avgTransit,
      qtyStock, qtyTransit, qtyExisting,
      avgAfter, qtyAfter,
      breakEven, custFin, sellPrice, realProfit, isRisk
    };
  });
};

// â”€â”€ DEFAULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const defInventory = [
  {id:1, alloy:'A5052', temper:'H32', thickness:'1.0', width:'1200', length:'2400', status:'IN_STOCK',   qtyKg:3000, avgCost:90000},
  {id:2, alloy:'A5052', temper:'H32', thickness:'1.0', width:'1200', length:'2400', status:'IN_TRANSIT', qtyKg:5000, avgCost:105000},
  {id:3, alloy:'A3003', temper:'H14', thickness:'0.8', width:'1000', length:'Coil', status:'IN_STOCK',   qtyKg:2000, avgCost:93000},
  {id:4, alloy:'A3003', temper:'H14', thickness:'0.8', width:'1000', length:'Coil', status:'IN_TRANSIT', qtyKg:4000, avgCost:99000},
  {id:5, alloy:'A1050', temper:'H14', thickness:'1.2', width:'1200', length:'Coil', status:'IN_STOCK',   qtyKg:1500, avgCost:88000},
];
const defSP = [
  {id:1, alloy:'A5052 H32', price:109000},
  {id:2, alloy:'A5052 H34', price:110500},
  {id:3, alloy:'A3003 H14', price:101000},
  {id:4, alloy:'A1050 H14', price: 97000},
  {id:5, alloy:'A6061 T6',  price:115000},
];
const defProducts = [
  {id:1, alloy:'A5052', temper:'H32', thickness:'1.0', width:'1200', length:'2400', qtyKg:5000, priceFC:4250},
  {id:2, alloy:'A3003', temper:'H14', thickness:'0.8', width:'1000', length:'Coil', qtyKg:3000, priceFC:4050},
];
const defInputs = {
  supplierName:'Yuwon Steel', creator:'Nguyá»…n VÄƒn A',
  paymentMethod:'LC', capitalCostPercent:6.5,
  lcMargin:10, lcDays:90, lcOpenFee:0.2, lcInterest:5.8,
  exchangeRate:26150, managementFee:1.0,
  leadTime:30, holdingTime:60,
  freightTotal:45000000, importTax:0, processingCost:200,
  contractPrice:105000, marketPrice:102000,
  businessRiskPercent:2.0, customerCreditDays:30, lendingRate:12.0,
};

// â”€â”€ ICONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Ic = {
  Plus:  ()=><svg style={{width:13,height:13}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}><path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4"/></svg>,
  X:     ()=><svg style={{width:12,height:12}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>,
  Ship:  ()=><svg style={{width:15,height:15}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>,
  Chart: ()=><svg style={{width:15,height:15}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
  Save:  ()=><svg style={{width:15,height:15}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>,
  Tag:   ()=><svg style={{width:15,height:15}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>,
  Print: ()=><svg style={{width:15,height:15}} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>,
};

// â”€â”€ SKU SELECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SkuSel = ({row, onChange}) => {
  const S = (f,v) => onChange({...row,[f]:v});
  return (
    <div style={{display:'flex',gap:'3px',alignItems:'center'}}>
      <select className="inp inp-xs" style={{minWidth:70}} value={row.alloy}     onChange={e=>S('alloy',e.target.value)}>{ALLOYS.map(a=><option key={a}>{a}</option>)}</select>
      <select className="inp inp-xs" style={{minWidth:46}} value={row.temper}    onChange={e=>S('temper',e.target.value)}>{TEMPERS.map(a=><option key={a}>{a}</option>)}</select>
      {/* phÃ¢n cÃ¡ch rÃµ hÆ¡n trÃªn mÃ n nhá» */}
      <span style={{color:'#3a5570',fontSize:'.75rem',flexShrink:0}}>â€¢</span>
      <select className="inp inp-xs" style={{minWidth:44}} value={row.thickness} onChange={e=>S('thickness',e.target.value)}>{THICKS.map(a=><option key={a}>{a}</option>)}</select>
      <span style={{color:'#3a5570',fontSize:'.75rem',flexShrink:0}}>Ã—</span>
      <select className="inp inp-xs" style={{minWidth:52}} value={row.width}     onChange={e=>S('width',e.target.value)}>{WIDTHS.map(a=><option key={a}>{a}</option>)}</select>
      <span style={{color:'#3a5570',fontSize:'.75rem',flexShrink:0}}>Ã—</span>
      <select className="inp inp-xs" style={{minWidth:56}} value={row.length}    onChange={e=>S('length',e.target.value)}>{LENGTHS.map(a=><option key={a}>{a}</option>)}</select>
    </div>
  );
};

// â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const App = () => {
  const [tab, setTab]           = useState('main');
  const [inputs, setInputs]     = useState(defInputs);
  const [products, setProducts] = useState(defProducts);
  const [inventory, setInvs]    = useState(defInventory);
  const [sellingPrices, setSP]  = useState(defSP);
  const [scenarios, setScenarios] = useState([]);
  const chartRef  = useRef(null);
  const chartInst = useRef(null);

  const setInp = useCallback((f,v)=>setInputs(p=>({...p,[f]:v})),[]);

  // COMPUTE
  const result = useMemo(()=>{
    const totalKg = products.reduce((s,p)=>s+p.qtyKg, 0);
    if (totalKg<=0) return null;
    const inv   = calcInvoice(products, inputs.exchangeRate);
    const land  = calcLanded(inv.invoiceVND, totalKg, inputs);
    const fin   = calcFinance(inv.invoiceVND, land, totalKg, inputs);
    const rows  = calcProductBreakdown(products, land, fin, totalKg, inputs);
    const blends= calcSkuBlend(inventory, rows, sellingPrices, inputs.contractPrice, inputs);
    const allInvRows   = inventory.map(r=>({qtyKg:r.qtyKg, avgCost:r.avgCost}));
    const newPurchRows = rows.map(r=>({qtyKg:r.qtyKg, avgCost:r.physPerKg}));
    const globalAvgBefore = weightedAvg(allInvRows);
    const globalAvgAfter  = weightedAvg([...allInvRows, ...newPurchRows]);
    const custFin         = globalAvgAfter*(inputs.lendingRate/100)*(inputs.customerCreditDays/365);
    const globalBreakEven = globalAvgAfter + fin.finPerKg + custFin;
    const hasRisk = blends.some(b=>b.isRisk);
    const rec = !hasRisk ? {txt:'NHáº¬P Báº¢O TOÃ€N',cls:'tg'}
              :  hasRisk ? {txt:'CÃ“ SKU Rá»¦I RO', cls:'tr'}
              : {txt:'NHáº¬P CÃ‚N Báº°NG',cls:'tb'};
    return {totalKg, ...inv, ...land, ...fin, rows, blends,
            globalAvgBefore, globalAvgAfter, globalBreakEven, custFin,
            hasRisk, rec};
  },[inputs, products, inventory, sellingPrices]);

  // CHART
  useEffect(()=>{
    if (!result || !chartRef.current) return;
    if (chartInst.current) chartInst.current.destroy();
    const labels = result.blends.map(b=>`${b.alloy} ${b.temper} ${b.thickness}mm`);
    chartInst.current = new Chart(chartRef.current.getContext('2d'),{
      type:'bar',
      data:{
        labels,
        datasets:[
          {label:'BQ Hiá»‡n táº¡i',  data:result.blends.map(b=>b.avgCurrent), backgroundColor:'#1e3a5f',borderRadius:3},
          {label:'LÃ´ má»›i vá» kho',data:result.blends.map(b=>b.physPerKg),  backgroundColor:'#14532d',borderRadius:3},
          {label:'BQ Sau nháº­p',  data:result.blends.map(b=>b.avgAfter),   backgroundColor:'#1d4ed8',borderRadius:3},
          {label:'Break-even',   data:result.blends.map(b=>b.breakEven),  backgroundColor:'#5b21b6',borderRadius:3},
          {label:'GiÃ¡ bÃ¡n HÄ',   data:result.blends.map(b=>b.sellPrice),  backgroundColor:'#166534',borderRadius:3},
        ]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{
          legend:{display:true,position:'bottom',labels:{color:'#7ba3be',font:{size:10},padding:8,usePointStyle:true}},
          tooltip:{callbacks:{label:c=>c.dataset.label+': '+fv(c.parsed.y)+' Ä‘/kg'}}
        },
        scales:{
          x:{grid:{color:'#1a2a3a'},ticks:{color:'#5a7a92',font:{size:9}}},
          y:{grid:{color:'#1a2a3a'},beginAtZero:false,
             min:result.blends.length ? Math.min(...result.blends.flatMap(b=>[b.avgCurrent,b.physPerKg]))*0.97 : 0,
             ticks:{color:'#5a7a92',font:{size:9},callback:v=>fv(v)}}
        }
      }
    });
  },[result]);

  // CRUD
  const addProduct = () => setProducts(p=>[...p,{id:uid(),alloy:'A5052',temper:'H32',thickness:'1.0',width:'1200',length:'Coil',qtyKg:1000,priceFC:4000}]);
  const delProduct = id => { if(products.length>1) setProducts(p=>p.filter(r=>r.id!==id)); };
  const setProduct = (id,patch) => setProducts(p=>p.map(r=>r.id===id?{...r,...patch}:r));
  const addInv  = () => setInvs(p=>[...p,{id:uid(),alloy:'A5052',temper:'H32',thickness:'1.0',width:'1200',length:'Coil',status:'IN_STOCK',qtyKg:0,avgCost:0}]);
  const delInv  = id => setInvs(p=>p.filter(r=>r.id!==id));
  const setInv  = (id,patch) => setInvs(p=>p.map(r=>r.id===id?{...r,...patch}:r));
  const addSP   = () => setSP(p=>[...p,{id:uid(),alloy:'A5052 H32',price:0}]);
  const delSP   = id => setSP(p=>p.filter(r=>r.id!==id));
  const setSpR  = (id,f,v) => setSP(p=>p.map(r=>r.id===id?{...r,[f]:v}:r));
  const saveScenario = () => {
    if (!result) return;
    setScenarios(p=>[...p,{
      id:uid(),
      name:`${new Date().toLocaleDateString('vi-VN')} Â· ${products.map(p=>p.alloy+' '+p.temper).join('+')}`,
      date:new Date().toLocaleDateString('vi-VN'),
      totalKg:result.totalKg, invoiceUSD:result.invoiceUSD,
      globalAvgBefore:result.globalAvgBefore, globalAvgAfter:result.globalAvgAfter,
      globalBreakEven:result.globalBreakEven, hasRisk:result.hasRisk,
      blendCount:result.blends.length,
      inputs:{...inputs}, products:[...products]
    }]);
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MÃ€U Ná»€N / viá»n inline â€” Ä‘á»“ng bá»™ vá»›i CSS má»›i
  // bg1 = panel ná»n, bg2 = card ná»n, bg3 = inset ná»n
  const bg1='#0e1520', bg2='#131e2e', bg3='#0c1726', bg4='#0a1220';
  const border1='#1e3347', border2='#2a3f58';
  // text: primary=dce6f4, secondary=7ba3be, muted=4a7090, dim=3a5570
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  return (
    <div style={{height:'100vh',display:'flex',flexDirection:'column',overflow:'hidden'}}>

      {/* â”€â”€ HEADER â”€â”€ */}
      <div style={{background:bg2,borderBottom:`1px solid ${border1}`,padding:'8px 16px',display:'flex',alignItems:'center',justifyContent:'space-between',flexShrink:0}}>
        <div style={{display:'flex',alignItems:'center',gap:'10px'}}>
          <div style={{background:'linear-gradient(135deg,#1d4ed8,#6d28d9)',borderRadius:'7px',width:'30px',height:'30px',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:900,fontSize:'15px',color:'#fff',fontFamily:'JetBrains Mono'}}>P</div>
          <div>
            {/* Header title: tÄƒng tá»« 14px â†’ 15px */}
            <div style={{fontWeight:900,fontSize:'15px',letterSpacing:'-.02em',color:'#dce6f4'}}>PAKD BUY <span style={{color:'#60a5fa',fontFamily:'JetBrains Mono',fontSize:'12px'}}>3.1</span></div>
            {/* Subtitle: tÄƒng tá»« 9px â†’ 11px, mÃ u sÃ¡ng #2a4055â†’#5a7a92 */}
            <div style={{fontSize:'11px',color:'#5a7a92',fontWeight:700,textTransform:'uppercase',letterSpacing:'.06em'}}>SKU-level Â· Tá»“n kho + Äi Ä‘Æ°á»ng + LÃ´ má»›i Â· H&amp;D</div>
          </div>
          <div style={{width:'1px',height:'24px',background:border1,margin:'0 4px'}}/>
          {[{k:'main',l:'ğŸ“Š PhÃ¢n tÃ­ch'},{k:'inventory',l:'ğŸ“¦ Tá»“n kho'},{k:'selling',l:'ğŸ·ï¸ GiÃ¡ bÃ¡n'},{k:'scenario',l:'ğŸ’¾ Scenarios'}]
            .map(t=><button key={t.k} onClick={()=>setTab(t.k)} className={`nav-tab ${tab===t.k?'on':''}`}>{t.l}</button>)}
        </div>
        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
          {result && <span className={`tag ${result.rec.cls}`}>{result.rec.txt}</span>}
          <button className="btn btn-success btn-sm" onClick={saveScenario} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Save/> LÆ°u</button>
          <button className="btn btn-solid btn-sm" onClick={()=>window.print()} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Print/> In A4</button>
        </div>
      </div>

      {/* â”€â”€ BODY â”€â”€ */}
      <div style={{flex:1,display:'flex',minHeight:0,overflow:'hidden'}}>

        {/* â•â•â•â• TAB MAIN â•â•â•â• */}
        {tab==='main' && (
          <div style={{display:'flex',width:'100%',height:'100%',minHeight:0}}>

            {/* LEFT CONFIG â€” tÄƒng width 238â†’248px */}
            <div style={{width:'248px',flexShrink:0,background:bg2,borderRight:`1px solid ${border1}`,overflowY:'auto',padding:'10px',display:'flex',flexDirection:'column',gap:'9px'}}>
              <div className="card">
                <div className="sh"><Ic.Ship/>ThÃ´ng sá»‘ nháº­p kháº©u</div>
                {/* Tá»· giÃ¡: font 1remâ†’1.05rem */}
                <label className="lbl" style={{color:'#60a5fa'}}>Tá»· giÃ¡ USD/VND</label>
                <input className="inp mono" style={{fontSize:'1.05rem',fontWeight:800,color:'#60a5fa',textAlign:'right',marginBottom:9}} value={fv(inputs.exchangeRate)} onChange={e=>setInp('exchangeRate',pn(e.target.value))} />
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'6px',marginBottom:7}}>
                  <div><label className="lbl" style={{color:'#d8b4fe'}}>Há»‡ sá»‘ QL %</label><input type="number" step=".1" className="inp inp-xs" style={{color:'#d8b4fe'}} value={inputs.managementFee} onChange={e=>setInp('managementFee',parseFloat(e.target.value)||0)}/></div>
                  <div><label className="lbl">Thuáº¿ NK %</label><input type="number" className="inp inp-xs" value={inputs.importTax} onChange={e=>setInp('importTax',parseFloat(e.target.value)||0)}/></div>
                  <div><label className="lbl">CÆ°á»›c VND tá»•ng</label><input className="inp inp-xs mono" style={{textAlign:'right'}} value={fv(inputs.freightTotal)} onChange={e=>setInp('freightTotal',pn(e.target.value))}/></div>
                  <div><label className="lbl">Gia cÃ´ng Ä‘/kg</label><input type="number" className="inp inp-xs" value={inputs.processingCost} onChange={e=>setInp('processingCost',pn(e.target.value))}/></div>
                  <div><label className="lbl">Lead time ngÃ y</label><input type="number" className="inp inp-xs" value={inputs.leadTime} onChange={e=>setInp('leadTime',parseInt(e.target.value)||0)}/></div>
                  <div><label className="lbl">Hold time ngÃ y</label><input type="number" className="inp inp-xs" value={inputs.holdingTime} onChange={e=>setInp('holdingTime',parseInt(e.target.value)||0)}/></div>
                </div>
                <div style={{display:'flex',gap:'5px',marginBottom:6}}>
                  {['TT','LC'].map(m=>(
                    <button key={m} className={`status-btn ${inputs.paymentMethod===m?(m==='TT'?'s-stock':'s-transit'):'off'}`} onClick={()=>setInp('paymentMethod',m)}>
                      {m==='TT'?'T/T':'L/C'}
                    </button>
                  ))}
                </div>
                {inputs.paymentMethod==='LC' ? (
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'4px',background:bg4,padding:'7px',borderRadius:'4px',border:`1px solid ${border1}`}}>
                    <div><label className="lbl">Margin%</label><input type="number" className="inp inp-xs" value={inputs.lcMargin} onChange={e=>setInp('lcMargin',parseFloat(e.target.value)||0)}/></div>
                    <div><label className="lbl">Days</label><input type="number" className="inp inp-xs" value={inputs.lcDays} onChange={e=>setInp('lcDays',parseInt(e.target.value)||0)}/></div>
                    <div><label className="lbl">Int%</label><input type="number" step=".1" className="inp inp-xs" value={inputs.lcInterest} onChange={e=>setInp('lcInterest',parseFloat(e.target.value)||0)}/></div>
                  </div>
                ) : (
                  <div><label className="lbl">LÃ£i suáº¥t vá»‘n %/nÄƒm</label><input type="number" step=".1" className="inp inp-xs" value={inputs.capitalCostPercent} onChange={e=>setInp('capitalCostPercent',parseFloat(e.target.value)||0)}/></div>
                )}
              </div>

              <div className="card">
                <div className="sh"><Ic.Tag/>Tham chiáº¿u bÃ¡n</div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'6px',marginBottom:7}}>
                  <div><label className="lbl" style={{color:'#4ade80'}}>GiÃ¡ HÄ/KH Ä‘/kg</label><input className="inp inp-xs mono" style={{textAlign:'right',color:'#4ade80',fontWeight:700}} value={fv(inputs.contractPrice)} onChange={e=>setInp('contractPrice',pn(e.target.value))}/></div>
                  <div><label className="lbl">TT Spot Ä‘/kg</label><input className="inp inp-xs mono" style={{textAlign:'right'}} value={fv(inputs.marketPrice)} onChange={e=>setInp('marketPrice',pn(e.target.value))}/></div>
                </div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'4px'}}>
                  <div><label className="lbl" style={{color:'#fc8181'}}>Rá»§i ro KD%</label><input type="number" step=".1" className="inp inp-xs" style={{color:'#fc8181'}} value={inputs.businessRiskPercent} onChange={e=>setInp('businessRiskPercent',parseFloat(e.target.value)||0)}/></div>
                  <div><label className="lbl" style={{color:'#d8b4fe'}}>CÃ´ng ná»£ ngÃ y</label><input type="number" className="inp inp-xs" style={{color:'#d8b4fe'}} value={inputs.customerCreditDays} onChange={e=>setInp('customerCreditDays',parseInt(e.target.value)||0)}/></div>
                  <div><label className="lbl" style={{color:'#fcd34d'}}>LÃ£i vay%/nÄƒm</label><input type="number" step=".1" className="inp inp-xs" style={{color:'#fcd34d'}} value={inputs.lendingRate} onChange={e=>setInp('lendingRate',parseFloat(e.target.value)||0)}/></div>
                </div>
              </div>
            </div>

            {/* CENTER */}
            <div style={{flex:1,minWidth:0,display:'flex',flexDirection:'column',background:bg1,borderRight:`1px solid ${border1}`}}>

              {/* Purchase table header */}
              <div style={{padding:'9px 13px',borderBottom:`1px solid ${border1}`,display:'flex',alignItems:'center',justifyContent:'space-between',flexShrink:0}}>
                <div style={{display:'flex',alignItems:'center',gap:'9px'}}>
                  <Ic.Ship/>
                  {/* tÄƒng .82â†’.88rem */}
                  <span style={{fontWeight:800,fontSize:'.88rem',color:'#dce6f4'}}>LÃ´ hÃ ng dá»± Ä‘á»‹nh mua</span>
                  <span className="tag tb">{products.length} SKU</span>
                  {result && <span className="tag ts mono">{fv(result.totalKg)} kg</span>}
                  {result && <span className="tag ty mono">{fu(result.invoiceUSD)}</span>}
                </div>
                <button className="btn btn-ghost btn-sm" onClick={addProduct} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Plus/> ThÃªm SKU</button>
              </div>

              {/* Purchase rows */}
              <div style={{overflowY:'auto',maxHeight:'30%',padding:'7px 13px'}}>
                <table className="tbl">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th style={{textAlign:'left',paddingLeft:5}}>SKU: Alloy Â· Temper Â· DÃ y Ã— Rá»™ng Ã— DÃ i</th>
                      <th>KL kg</th><th>USD/Táº¥n</th><th>Invoice</th><th>Vá» kho Ä‘/kg</th><th></th>
                    </tr>
                  </thead>
                  <tbody>
                    {products.map((p,i)=>{
                      const rb = result?.rows?.find(r=>r.id===p.id);
                      return (
                        <tr key={p.id}>
                          {/* sá»‘ thá»© tá»± sÃ¡ng hÆ¡n: #1e3a5fâ†’#4a7090 */}
                          <td style={{textAlign:'center',color:'#4a7090',fontSize:'.75rem'}} className="mono">{i+1}</td>
                          <td style={{paddingLeft:5}}><SkuSel row={p} onChange={patch=>setProduct(p.id,patch)}/></td>
                          <td style={{width:90}}>
                            <input className="inp inp-xs mono" style={{textAlign:'right',color:'#4ade80',fontWeight:700}} value={fv(p.qtyKg)} onChange={e=>setProduct(p.id,{qtyKg:pn(e.target.value)})}/>
                          </td>
                          <td style={{width:80}}>
                            <input type="number" className="inp inp-xs mono" style={{textAlign:'right',color:'#fcd34d'}} value={p.priceFC} onChange={e=>setProduct(p.id,{priceFC:parseFloat(e.target.value)||0})}/>
                          </td>
                          {/* Invoice: mÃ u sÃ¡ng #3a5060â†’#5a7a92 */}
                          <td className="mono" style={{textAlign:'right',paddingRight:7,color:'#5a7a92',fontSize:'.78rem'}}>{fu((p.qtyKg/1000)*p.priceFC)}</td>
                          <td style={{textAlign:'right',paddingRight:7}}>
                            {rb ? <span className="mono" style={{fontSize:'.82rem',fontWeight:700,color:rb.physPerKg>(result?.globalAvgBefore||0)?'#fc8181':'#4ade80'}}>{fv(rb.physPerKg)}</span>
                                : <span style={{color:'#3a5570'}}>â€”</span>}
                          </td>
                          <td><button className="btn-danger" onClick={()=>delProduct(p.id)}><Ic.X/></button></td>
                        </tr>
                      );
                    })}
                  </tbody>
                  {result && (
                    <tfoot>
                      <tr>
                        {/* footer label sÃ¡ng hÆ¡n #2a4055â†’#5a7a92 */}
                        <td colSpan={2} style={{textAlign:'right',color:'#5a7a92',fontSize:'.7rem',paddingRight:9}}>Tá»”NG / BQ</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:7,color:'#4ade80'}}>{fv(result.totalKg)}</td>
                        <td/>
                        <td className="mono" style={{textAlign:'right',paddingRight:7,color:'#fcd34d'}}>{fu(result.invoiceUSD)}</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:7,color:'#93c5fd'}}>{fv(result.landedPerKg)} avg</td>
                        <td/>
                      </tr>
                    </tfoot>
                  )}
                </table>
              </div>

              <div className="div-line" style={{margin:'0 13px'}}/>

              {/* SKU section header */}
              <div style={{padding:'6px 13px 5px',flexShrink:0,display:'flex',alignItems:'center',justifyContent:'space-between'}}>
                <div style={{display:'flex',alignItems:'center',gap:'9px'}}>
                  <Ic.Chart/>
                  {/* tÄƒng .8â†’.86rem */}
                  <span style={{fontWeight:800,fontSize:'.86rem',color:'#dce6f4'}}>PhÃ¢n tÃ­ch SKU Â· Kho + ÄÆ°á»ng + LÃ´ má»›i</span>
                  {/* chÃº thÃ­ch: .6â†’.7rem, #1e3a5fâ†’#4a7090 */}
                  <span style={{fontSize:'.7rem',color:'#4a7090'}}>â†³ Break-even tÃ­nh tá»« BQ sau nháº­p</span>
                </div>
                <div style={{display:'flex',gap:'9px',fontSize:'.68rem',color:'#5a7a92'}}>
                  <span><span className="tag tg" style={{fontSize:'.64rem'}}>IN_STOCK</span> Kho</span>
                  <span><span className="tag ty" style={{fontSize:'.64rem'}}>IN_TRANSIT</span> Äang vá»</span>
                </div>
              </div>

              {/* SKU Cards */}
              <div style={{flex:1,overflowY:'auto',padding:'5px 13px 11px'}}>
                {result?.blends?.length > 0 ? (
                  <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(340px,1fr))',gap:'9px'}}>
                    {result.blends.map((b,i)=>(
                      <div key={b.skuKey+i} className={`sku-card ${b.isRisk?'warn':b.realProfit>1000?'ok':''}`}>

                        {/* Card header */}
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:9}}>
                          <div>
                            {/* alloy/temper tÄƒng .8â†’.88rem */}
                            <div style={{fontWeight:800,fontSize:'.88rem',color:'#dce6f4'}}>{b.alloy} {b.temper}</div>
                            {/* dimension tÄƒng .63â†’.72rem, mÃ u #2a4055â†’#5a7a92 */}
                            <div style={{fontSize:'.72rem',color:'#5a7a92',marginTop:2,fontFamily:'JetBrains Mono'}}>{b.thickness}mm Ã— {b.width} Ã— {b.length}</div>
                          </div>
                          <span className={`tag ${b.isRisk?'tr':b.realProfit>0?'tg':'ty'}`}>
                            {b.isRisk ? 'âš  Rá»¦I RO' : b.realProfit>0 ? 'âœ“ CÃ“ LÃƒI' : 'â‰ˆ HÃ’A Vá»N'}
                          </span>
                        </div>

                        {/* 3 pools */}
                        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'5px',marginBottom:9}}>
                          {[
                            {ico:'ğŸŸ¢',lbl:'Trong kho',qty:b.qtyStock,  avg:b.avgStock,  bg:'#051809',br:'#166534',vc:'#4ade80',ac:'#22c55e'},
                            {ico:'ğŸŸ¡',lbl:'Äang vá»',  qty:b.qtyTransit,avg:b.avgTransit,bg:'#1c1400',br:'#854d0e',vc:'#fcd34d',ac:'#f59e0b'},
                            {ico:'ğŸ”µ',lbl:'LÃ´ má»›i',   qty:b.qtyKg,     avg:b.physPerKg, bg:'#04102e',br:'#1d4ed8',vc:'#93c5fd',ac:'#60a5fa'},
                          ].map((x,j)=>(
                            <div key={j} style={{background:x.bg,border:`1px solid ${x.br}`,borderRadius:5,padding:'6px 8px'}}>
                              {/* label pool tÄƒng .52â†’.65rem, mÃ u rÃµ hÆ¡n */}
                              <div style={{fontSize:'.65rem',color:x.vc,fontWeight:700,marginBottom:3,opacity:.85}}>{x.ico} {x.lbl}</div>
                              {/* sá»‘ kg tÄƒng .82â†’.88rem */}
                              <div className="mono" style={{fontSize:'.88rem',fontWeight:700,color:x.vc}}>{fv(x.qty)}<span style={{fontSize:'.62rem',opacity:.7}}> kg</span></div>
                              {/* giÃ¡ tÄƒng .63â†’.72rem */}
                              <div className="mono" style={{fontSize:'.72rem',color:x.ac,marginTop:1}}>{fv(x.avg)} Ä‘/kg</div>
                            </div>
                          ))}
                        </div>

                        {/* BQ flow */}
                        <div style={{display:'flex',alignItems:'stretch',gap:4,marginBottom:9,background:bg4,borderRadius:5,padding:'7px 9px'}}>
                          {[
                            {l:'BQ Hiá»‡n táº¡i', v:b.avgCurrent,q:b.qtyExisting,c:'#94a3b8'},
                            null,
                            {l:'BQ Sau nháº­p', v:b.avgAfter,  q:b.qtyAfter,   c:b.avgAfter>b.avgCurrent?'#fc8181':'#93c5fd', bold:true},
                            null,
                            {l:'Break-even',  v:b.breakEven, q:null,          c:'#d8b4fe'},
                          ].map((x,j)=> x===null ? (
                            <div key={j} style={{color:'#3a5570',fontSize:'1rem',alignSelf:'center',paddingTop:9}}>â†’</div>
                          ) : (
                            <div key={j} style={{flex:1,textAlign:'center'}}>
                              {/* label tÄƒng .5â†’.64rem, mÃ u #2a4055â†’#5a7a92 */}
                              <div style={{fontSize:'.64rem',color:'#5a7a92',marginBottom:3}}>{x.l}</div>
                              {/* value tÄƒng .78â€“.88â†’.85â€“.95rem */}
                              <div className="mono" style={{fontSize:x.bold?'.95rem':'.84rem',fontWeight:x.bold?900:700,color:x.c}}>{fv(x.v)}</div>
                              {/* qty tÄƒng .5â†’.63rem, #1e3a5fâ†’#3a5570 */}
                              {x.q!==null && <div style={{fontSize:'.63rem',color:'#3a5570',marginTop:2}}>{fv(x.q)} kg</div>}
                            </div>
                          ))}
                        </div>

                        {/* P&L */}
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-end'}}>
                          <div>
                            {/* label tÄƒng .55â†’.67rem */}
                            <div style={{fontSize:'.67rem',color:'#5a7a92'}}>GiÃ¡ bÃ¡n theo mÃ£</div>
                            {/* value tÄƒng .8â†’.86rem */}
                            <div className="mono" style={{fontSize:'.86rem',fontWeight:700,color:'#4ade80'}}>{fv(b.sellPrice)} Ä‘/kg</div>
                          </div>
                          <div style={{textAlign:'right'}}>
                            <div style={{fontSize:'.67rem',color:'#5a7a92'}}>LÃ£i / Lá»— thá»±c</div>
                            {/* value tÄƒng .9â†’1rem */}
                            <div className="mono" style={{fontSize:'1rem',fontWeight:900,color:b.realProfit>=0?'#4ade80':'#fc8181'}}>
                              {b.realProfit>=0?'+':''}{fv(b.realProfit)} Ä‘/kg
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div style={{textAlign:'center',padding:'40px',color:'#4a7090',fontSize:'.85rem'}}>Nháº­p dá»¯ liá»‡u lÃ´ hÃ ng Ä‘á»ƒ xem phÃ¢n tÃ­ch SKU</div>
                )}
              </div>

              {/* Cost breakdown bar */}
              {result && (
                <div style={{padding:'6px 13px 9px',borderTop:`1px solid ${border1}`,flexShrink:0}}>
                  <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:'5px'}}>
                    {[
                      {l:'Invoice',      v:result.invoiceVND, c:'#5a7a92'},
                      {l:`QL ${inputs.managementFee}%`,v:result.mgmt,    c:'#a78bfa'},
                      {l:'Thuáº¿ NK',      v:result.tax,        c:'#f59e0b'},
                      {l:'CÆ°á»›c+Logs',    v:result.freight,    c:'#38bdf8'},
                      {l:'Gia cÃ´ng',     v:result.proc,       c:'#2dd4bf'},
                      {l:'CP tÃ i chÃ­nh', v:result.finVND,     c:'#f87171'},
                    ].map((x,i)=>(
                      <div key={i} style={{background:bg3,border:`1px solid ${border1}`,borderRadius:4,padding:'5px 7px',textAlign:'center'}}>
                        {/* sá»‘ tÄƒng .68â†’.76rem */}
                        <div className="mono" style={{fontSize:'.76rem',fontWeight:700,color:x.c}}>{fv(x.v)}</div>
                        {/* label tÄƒng .5â†’.63rem, mÃ u #1e3a5fâ†’#4a7090 */}
                        <div style={{fontSize:'.63rem',color:'#4a7090',marginTop:2}}>{x.l}</div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* RIGHT KPI â€” tÄƒng width 224â†’234px */}
            <div style={{width:'234px',flexShrink:0,background:bg2,overflowY:'auto',padding:'10px',display:'flex',flexDirection:'column',gap:'9px'}}>
              {result ? (
                <>
                  <div className="kpi">
                    <div className="kpi-l">BQ ToÃ n kho Hiá»‡n táº¡i</div>
                    <div className="kpi-v" style={{color:'#94a3b8',fontSize:'1rem'}}>{fv(result.globalAvgBefore)}</div>
                    <div className="kpi-s">Ä‘/kg Â· {fv(inventory.reduce((s,r)=>s+r.qtyKg,0))} kg</div>
                  </div>

                  <div className="kpi" style={{background:'#060f28',borderColor:'#1d4ed8'}}>
                    <div className="kpi-l" style={{color:'#60a5fa'}}>BQ Sau Nháº­p (toÃ n kho)</div>
                    <div className="kpi-v" style={{color:'#93c5fd'}}>{fv(result.globalAvgAfter)}</div>
                    <div style={{display:'flex',alignItems:'center',gap:6,marginTop:4}}>
                      <span className="kpi-s">Ä‘/kg</span>
                      <span className={`tag ${result.globalAvgAfter>result.globalAvgBefore?'tr':'tg'} mono`} style={{fontSize:'.66rem'}}>
                        {result.globalAvgAfter>result.globalAvgBefore?'â–²':'â–¼'} {fv(Math.abs(result.globalAvgAfter-result.globalAvgBefore))}
                      </span>
                    </div>
                  </div>

                  <div className="kpi" style={{background:'#0d0428',borderColor:'#6d28d9'}}>
                    <div className="kpi-l" style={{color:'#9333ea'}}>Break-even ToÃ n kho</div>
                    <div className="kpi-v" style={{color:'#d8b4fe',fontSize:'1.05rem'}}>{fv(result.globalBreakEven)}</div>
                    <div className="kpi-s">Ä‘/kg Â· giÃ¡ bÃ¡n tá»‘i thiá»ƒu</div>
                  </div>

                  {/* SKU risk mini â€” label tÄƒng .56â†’.68rem */}
                  <div className="card-inset" style={{padding:'9px'}}>
                    <div style={{fontSize:'.68rem',fontWeight:700,color:'#5a7a92',textTransform:'uppercase',marginBottom:6}}>SKU Risk</div>
                    {result.blends.map((b,i)=>(
                      <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:5,padding:'4px 6px',background:bg1,borderRadius:4,border:`1px solid ${b.isRisk?'#991b1b':border1}`}}>
                        {/* SKU text tÄƒng .62â†’.72rem */}
                        <div style={{fontSize:'.72rem',fontWeight:700,color:'#dce6f4'}}>{b.alloy} {b.temper} {b.thickness}mm</div>
                        {/* profit tÄƒng .6â†’.7rem */}
                        <span className="mono" style={{fontSize:'.7rem',color:b.realProfit>=0?'#4ade80':'#fc8181',fontWeight:700}}>
                          {b.realProfit>=0?'+':''}{fv(b.realProfit)}
                        </span>
                      </div>
                    ))}
                  </div>

                  <div className="chart-box" style={{height:190}}>
                    {/* chart title tÄƒng .54â†’.66rem */}
                    <div style={{fontSize:'.66rem',color:'#5a7a92',fontWeight:700,textTransform:'uppercase',marginBottom:4}}>GiÃ¡ vá»‘n theo SKU</div>
                    <canvas ref={chartRef} style={{height:162}}></canvas>
                  </div>

                  <div style={{display:'flex',flexDirection:'column',gap:5}}>
                    {[
                      {l:'vs Há»£p Ä‘á»“ng', ref:inputs.contractPrice,ok:result.globalBreakEven<=inputs.contractPrice,y:'BÃN ÄÆ¯á»¢C',n:'KHÃ”NG LÃƒI'},
                      {l:'vs TT Spot',  ref:inputs.marketPrice,  ok:result.globalBreakEven<=inputs.marketPrice,  y:'Cáº NH TRANH',n:'CAO HÆ N TT'},
                    ].map((d,i)=>(
                      <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',background:bg4,border:`1px solid ${border1}`,borderRadius:5,padding:'6px 9px'}}>
                        <div>
                          {/* label tÄƒng .54â†’.66rem, #1e3a5fâ†’#5a7a92 */}
                          <div style={{fontSize:'.66rem',color:'#5a7a92'}}>{d.l}</div>
                          {/* value tÄƒng .78â†’.85rem */}
                          <div className="mono" style={{fontSize:'.85rem',fontWeight:700,color:'#dce6f4'}}>{fv(d.ref)}</div>
                        </div>
                        <span className={`tag ${d.ok?'tg':'tr'}`}>{d.ok?d.y:d.n}</span>
                      </div>
                    ))}
                  </div>

                  {/* Recommendation box */}
                  <div style={{textAlign:'center',padding:'9px',borderRadius:7,
                    border:`1px solid ${result.rec.cls==='tg'?'#166534':result.rec.cls==='tb'?'#1d4ed8':'#991b1b'}`,
                    background:result.rec.cls==='tg'?'#020d05':result.rec.cls==='tb'?'#030a1c':'#0c0202'}}>
                    {/* "KHUYáº¾N NGHá»Š" tÄƒng .54â†’.66rem */}
                    <div style={{fontSize:'.66rem',color:'#4a7090',marginBottom:3}}>KHUYáº¾N NGHá»Š</div>
                    {/* value tÄƒng .95â†’1rem */}
                    <div style={{fontSize:'1rem',fontWeight:900,color:result.rec.cls==='tg'?'#4ade80':result.rec.cls==='tb'?'#93c5fd':'#fc8181'}}>{result.rec.txt}</div>
                  </div>
                </>
              ) : (
                <div style={{textAlign:'center',padding:'40px',color:'#4a7090',fontSize:'.82rem'}}>Nháº­p dá»¯ liá»‡u Ä‘á»ƒ xem KPI</div>
              )}
            </div>
          </div>
        )}

        {/* â•â•â•â• TAB INVENTORY â•â•â•â• */}
        {tab==='inventory' && (
          <div style={{flex:1,padding:'18px',overflowY:'auto',background:bg1}}>
            <div style={{maxWidth:'1020px',margin:'0 auto'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:15}}>
                <div>
                  <h2 style={{fontWeight:900,fontSize:'1.05rem',color:'#dce6f4'}}>ğŸ“¦ Tá»“n kho chi tiáº¿t theo SKU</h2>
                  {/* sub tÄƒng .72â†’.78rem, #2a4055â†’#5a7a92 */}
                  <p style={{fontSize:'.78rem',color:'#5a7a92',marginTop:3}}>Má»—i dÃ²ng = 1 SKU Ä‘áº§y Ä‘á»§ (alloy + temper + dÃ y Ã— rá»™ng Ã— dÃ i) + tráº¡ng thÃ¡i IN_STOCK / IN_TRANSIT</p>
                </div>
                <button className="btn btn-ghost btn-sm" onClick={addInv} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Plus/> ThÃªm dÃ²ng</button>
              </div>

              <table className="tbl" style={{background:bg3,borderRadius:8,overflow:'hidden'}}>
                <thead>
                  <tr>
                    <th>#</th>
                    <th style={{textAlign:'left',paddingLeft:5}}>SKU</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th>Sá»‘ lÆ°á»£ng kg</th>
                    <th>GiÃ¡ vá»‘n Ä‘/kg</th>
                    <th>Tá»•ng giÃ¡ trá»‹ VND</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {inventory.map((r,i)=>(
                    <tr key={r.id}>
                      <td style={{textAlign:'center',color:'#4a7090',fontSize:'.75rem'}} className="mono">{i+1}</td>
                      <td style={{paddingLeft:5}}><SkuSel row={r} onChange={patch=>setInv(r.id,patch)}/></td>
                      <td style={{textAlign:'center',width:165}}>
                        <div style={{display:'flex',gap:4,justifyContent:'center'}}>
                          <button className={`status-btn ${r.status==='IN_STOCK'?'s-stock':'off'}`} style={{padding:'3px 7px'}} onClick={()=>setInv(r.id,{status:'IN_STOCK'})}>ğŸŸ¢ Kho</button>
                          <button className={`status-btn ${r.status==='IN_TRANSIT'?'s-transit':'off'}`} style={{padding:'3px 7px'}} onClick={()=>setInv(r.id,{status:'IN_TRANSIT'})}>ğŸŸ¡ ÄÆ°á»ng</button>
                        </div>
                      </td>
                      <td style={{width:105}}>
                        <input className="inp inp-xs mono" style={{textAlign:'right',color:'#4ade80',fontWeight:700}} value={fv(r.qtyKg)} onChange={e=>setInv(r.id,{qtyKg:pn(e.target.value)})}/>
                      </td>
                      <td style={{width:115}}>
                        <input className="inp inp-xs mono" style={{textAlign:'right'}} value={fv(r.avgCost)} onChange={e=>setInv(r.id,{avgCost:pn(e.target.value)})}/>
                      </td>
                      <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#93c5fd',fontSize:'.78rem'}}>{fv(r.qtyKg*r.avgCost)}</td>
                      <td><button className="btn-danger" onClick={()=>delInv(r.id)}><Ic.X/></button></td>
                    </tr>
                  ))}
                </tbody>
                <tfoot>
                  <tr>
                    <td colSpan={3} style={{textAlign:'right',paddingRight:9,color:'#5a7a92',fontSize:'.7rem'}}>Tá»”NG</td>
                    <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#4ade80'}}>{fv(inventory.reduce((s,r)=>s+r.qtyKg,0))} kg</td>
                    <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#94a3b8'}}>
                      {fv(weightedAvg(inventory.map(r=>({qtyKg:r.qtyKg,avgCost:r.avgCost}))))} Ä‘/kg avg
                    </td>
                    <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#93c5fd'}}>{fv(inventory.reduce((s,r)=>s+r.qtyKg*r.avgCost,0))}</td>
                    <td/>
                  </tr>
                </tfoot>
              </table>

              {/* SKU summary cards */}
              <div style={{marginTop:15}}>
                {/* label tÄƒng .68â†’.75rem, #1e3a5fâ†’#4a7090 */}
                <div style={{fontSize:'.75rem',fontWeight:800,color:'#4a7090',textTransform:'uppercase',letterSpacing:'.06em',marginBottom:9}}>
                  TÃ³m táº¯t theo SKU (Kho + ÄÆ°á»ng pooled)
                </div>
                <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(230px,1fr))',gap:'9px'}}>
                  {groupBySku(inventory).map(g=>{
                    const all = [...g.inStock,...g.inTransit];
                    const qtyS = g.inStock.reduce((s,r)=>s+r.qtyKg,0);
                    const qtyT = g.inTransit.reduce((s,r)=>s+r.qtyKg,0);
                    const avgAll = weightedAvg(all.map(r=>({qtyKg:r.qtyKg,avgCost:r.avgCost})));
                    return (
                      <div key={g.key} className="sku-card">
                        {/* tÃªn SKU tÄƒng .75â†’.82rem */}
                        <div style={{fontWeight:800,fontSize:'.82rem',color:'#dce6f4',marginBottom:5}}>{g.label}</div>
                        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:5,marginBottom:6}}>
                          <div style={{background:'#051809',border:'1px solid #166534',borderRadius:4,padding:'5px 7px'}}>
                            {/* pool label tÄƒng .52â†’.66rem, mÃ u #064e1eâ†’#22c55e */}
                            <div style={{fontSize:'.66rem',color:'#22c55e',fontWeight:700,opacity:.8}}>ğŸŸ¢ Kho</div>
                            <div className="mono" style={{fontSize:'.85rem',fontWeight:700,color:'#4ade80'}}>{fv(qtyS)} kg</div>
                          </div>
                          <div style={{background:'#1c1400',border:'1px solid #854d0e',borderRadius:4,padding:'5px 7px'}}>
                            <div style={{fontSize:'.66rem',color:'#f59e0b',fontWeight:700,opacity:.8}}>ğŸŸ¡ ÄÆ°á»ng</div>
                            <div className="mono" style={{fontSize:'.85rem',fontWeight:700,color:'#fcd34d'}}>{fv(qtyT)} kg</div>
                          </div>
                        </div>
                        <div style={{display:'flex',justifyContent:'space-between'}}>
                          {/* footer tÄƒng .6â†’.7rem, #2a4055â†’#5a7a92 */}
                          <span style={{fontSize:'.7rem',color:'#5a7a92'}}>Tá»•ng <strong className="mono" style={{color:'#dce6f4'}}>{fv(qtyS+qtyT)} kg</strong></span>
                          <span style={{fontSize:'.7rem',color:'#5a7a92'}}>BQ <strong className="mono" style={{color:'#93c5fd'}}>{fv(avgAll)} Ä‘/kg</strong></span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* â•â•â•â• TAB SELLING PRICES â•â•â•â• */}
        {tab==='selling' && (
          <div style={{flex:1,padding:'18px',overflowY:'auto',background:bg1}}>
            <div style={{maxWidth:'700px',margin:'0 auto'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:15}}>
                <div>
                  <h2 style={{fontWeight:900,fontSize:'1.05rem',color:'#dce6f4'}}>ğŸ·ï¸ GiÃ¡ bÃ¡n theo mÃ¡c nhÃ´m</h2>
                  <p style={{fontSize:'.78rem',color:'#5a7a92',marginTop:3}}>Format: "Alloy Temper" (VD: A5052 H32). Tra theo Alloy+Temper trÆ°á»›c â†’ Alloy â†’ máº·c Ä‘á»‹nh</p>
                </div>
                <button className="btn btn-ghost btn-sm" onClick={addSP} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Plus/> ThÃªm</button>
              </div>
              <table className="tbl" style={{background:bg3,borderRadius:8,overflow:'hidden'}}>
                <thead><tr><th>#</th><th style={{textAlign:'left',paddingLeft:9}}>MÃ¡c nhÃ´m</th><th>GiÃ¡ bÃ¡n Ä‘/kg</th><th>vs GiÃ¡ HÄ máº·c Ä‘á»‹nh</th><th></th></tr></thead>
                <tbody>
                  {sellingPrices.map((sp,i)=>{
                    const diff = sp.price - inputs.contractPrice;
                    return (
                      <tr key={sp.id}>
                        <td style={{textAlign:'center',color:'#4a7090',fontSize:'.75rem'}} className="mono">{i+1}</td>
                        <td style={{paddingLeft:9}}><input className="inp inp-sm" style={{width:155}} value={sp.alloy} onChange={e=>setSpR(sp.id,'alloy',e.target.value)}/></td>
                        <td style={{width:145}}><input className="inp inp-sm mono" style={{textAlign:'right',color:'#4ade80',fontWeight:700}} value={fv(sp.price)} onChange={e=>setSpR(sp.id,'price',pn(e.target.value))}/></td>
                        <td style={{textAlign:'center'}}><span className={`tag ${diff>=0?'tg':'tr'} mono`}>{diff>=0?'+':''}{fv(diff)}</span></td>
                        <td><button className="btn-danger" onClick={()=>delSP(sp.id)}><Ic.X/></button></td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
              <div className="card-inset" style={{marginTop:13}}>
                {/* tÄƒng .72â†’.78rem, #2a4055â†’#5a7a92 */}
                <p style={{fontSize:'.78rem',color:'#5a7a92',lineHeight:1.8}}>
                  ğŸ’¡ Logic tra: <strong style={{color:'#93c5fd'}}>A5052 H32</strong> â†’ <strong style={{color:'#94a3b8'}}>A5052</strong> â†’ <strong style={{color:'#4ade80'}}>GiÃ¡ HÄ máº·c Ä‘á»‹nh {fv(inputs.contractPrice)}</strong> Ä‘/kg
                </p>
              </div>
            </div>
          </div>
        )}

        {/* â•â•â•â• TAB SCENARIOS â•â•â•â• */}
        {tab==='scenario' && (
          <div style={{flex:1,padding:'18px',overflowY:'auto',background:bg1}}>
            <div style={{maxWidth:'940px',margin:'0 auto'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:15}}>
                <div>
                  <h2 style={{fontWeight:900,fontSize:'1.05rem',color:'#dce6f4'}}>ğŸ’¾ Scenarios lÆ°u trá»¯</h2>
                  <p style={{fontSize:'.78rem',color:'#5a7a92',marginTop:3}}>So sÃ¡nh cÃ¡c phÆ°Æ¡ng Ã¡n nháº­p hÃ ng theo thá»i gian</p>
                </div>
                <button className="btn btn-success btn-sm" onClick={saveScenario} style={{display:'flex',alignItems:'center',gap:4}}><Ic.Save/> LÆ°u scenario</button>
              </div>
              {scenarios.length===0 ? (
                <div className="card" style={{textAlign:'center',padding:44,border:`1px dashed ${border2}`}}>
                  <div style={{fontSize:'2rem',marginBottom:11}}>ğŸ’¾</div>
                  {/* tÄƒng mÃ u #2a4055â†’#5a7a92 */}
                  <div style={{color:'#7ba3be',fontWeight:700,fontSize:'.9rem'}}>ChÆ°a cÃ³ scenario</div>
                  <div style={{fontSize:'.76rem',color:'#4a7090',marginTop:7}}>Nháº¥n "LÆ°u Scenario" sau khi nháº­p Ä‘áº§y Ä‘á»§ dá»¯ liá»‡u</div>
                </div>
              ) : (
                <table className="tbl" style={{background:bg3,borderRadius:8,overflow:'hidden'}}>
                  <thead>
                    <tr><th>#</th><th style={{textAlign:'left',paddingLeft:9}}>TÃªn</th><th>KL</th><th>Invoice</th><th>BQ trÆ°á»›c</th><th>BQ sau</th><th>Break-even</th><th>Rá»§i ro</th><th></th></tr>
                  </thead>
                  <tbody>
                    {scenarios.map((s,i)=>(
                      <tr key={s.id}>
                        <td style={{textAlign:'center',color:'#4a7090',fontSize:'.75rem'}} className="mono">{i+1}</td>
                        <td style={{paddingLeft:9}}>
                          <div style={{fontWeight:700,fontSize:'.82rem',color:'#dce6f4'}}>{s.name}</div>
                          <div style={{fontSize:'.68rem',color:'#5a7a92',marginTop:1}}>{s.date}</div>
                        </td>
                        <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#4ade80'}}>{fv(s.totalKg)}</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#fcd34d'}}>{fu(s.invoiceUSD)}</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#94a3b8'}}>{fv(s.globalAvgBefore)}</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#93c5fd',fontWeight:700}}>{fv(s.globalAvgAfter)}</td>
                        <td className="mono" style={{textAlign:'right',paddingRight:9,color:'#d8b4fe'}}>{fv(s.globalBreakEven)}</td>
                        <td style={{textAlign:'center'}}><span className={`tag ${s.hasRisk?'tr':'tg'}`}>{s.hasRisk?'âš  Rá»§i ro':'âœ“ An toÃ n'}</span></td>
                        <td style={{textAlign:'center'}}>
                          <div style={{display:'flex',gap:4,justifyContent:'center'}}>
                            <button className="btn btn-solid btn-xs" onClick={()=>{setProducts(s.products);setInputs(s.inputs);setTab('main');}}>Táº£i</button>
                            <button className="btn-danger" onClick={()=>setScenarios(p=>p.filter(x=>x.id!==s.id))}><Ic.X/></button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>
          </div>
        )}

      </div>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
